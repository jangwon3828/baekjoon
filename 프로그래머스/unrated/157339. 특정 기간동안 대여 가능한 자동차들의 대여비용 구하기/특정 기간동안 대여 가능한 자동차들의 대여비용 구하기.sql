SELECT A.CAR_ID, A.CAR_TYPE, ROUND(A.DAILY_FEE*30*(1-(DISCOUNT_RATE/100))) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN C
    ON A.CAR_TYPE = C.CAR_TYPE
WHERE A.CAR_TYPE IN ('세단','SUV')
    AND C.DURATION_TYPE = '30일 이상'
    AND A.CAR_ID NOT IN (
        SELECT B.CAR_ID
        FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY B
        WHERE (B.END_DATE BETWEEN '2022-11-01' AND '2022-11-30') 
            OR (B.START_DATE BETWEEN '2022-11-01' AND '2022-11-30') 
            OR (B.START_DATE <'2022-11-01' AND B.END_DATE > '2022-11-30')
        )
    AND A.DAILY_FEE*30*(1-(DISCOUNT_RATE/100)) >= 500000 AND A.DAILY_FEE*30*(1-(DISCOUNT_RATE/100)) < 2000000
ORDER BY A.DAILY_FEE*30*(1-(DISCOUNT_RATE/100)) DESC, A.CAR_TYPE ASC, A.CAR_ID DESC